<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon-152x152.png">
    <meta name="apple-mobile-web-app-title" content="GorillaPresenter">
    <title>Gorilla Presenter Launcher</title>
    <style>
        .hidden {
            display: none;
        }
        body {
        background-color: #f5f5f0;
        padding:0;
        margin:0;
        font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
              Roboto, Oxygen-Sans,
              Ubuntu, Cantarell,
              "Helvetica Neue", sans-serif;
      }
      .mainscreen{
        background-color:#f5f5f0;
        margin:0;
        padding:0.5em;
        padding-bottom:0.25em;
        font-size:125%;
        border-top:none;
    }
    #title{
        border:none;
        border-bottom:1px solid #77b;
    }
    </style>
</head>
<body>
  <div id="title" class="mainscreen">
    <img title="logo" src="icons/apple-touch-icon-152x152.png" width="10%" height="10%" /><span class="title"> Gorilla Launcher</span><br />
  </div>
  <div id="mainUI" class="hidden">
    <p>
      <label for="workspace-chooser">Choose a presentation:</label> <input type="file" id="workspace-chooser" onchange="workspaceChosen()" accept="html" />
    </p>
  </div>
    <div id="notMobileSafari" class="hidden">
        This launcher is not necessary for your browser. It's only needed for Safari on iOS.
    </div>
    <div id="installPrompt" class="hidden">
      <p>
        To add the Gorilla Presenter launcher to your iPhone or iPad home screen, click the share icon. <img src="icons/shareicon.png" width="30" height="30" />
        </p>
  
        <p>
        This icon is found at the top of the screen on iPads, and at the bottom on iPhones. You may need to swipe up or down to get the menu to appear.
        </p>
        <p>
          Once you see the icon, tap it, then choose "Add to Home Screen". You may need to scroll down to see that option.
          </p>
    </div>
 

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        function isInStandaloneMode() {
            return ('standalone' in window.navigator) && (window.navigator.standalone);
        }

        function isSafari() {
          let safariAgent =  /safari/i.test(navigator.userAgent) && !/chrome/i.test(navigator.userAgent);
          if(safariAgent === false){
            console.log("didn't get Safari user agent");
            return false;
          }
          console.log("got Safari user agent");
          if('standalone' in window.navigator){
            console.log("Mobile Safari");
            return true;
          }
          console.log("Not Mobile Safari");
          return false;
        }
        function isiOS(){
          return /iPad|iPhone|iPod/.test(navigator.userAgent);

        }
        function displayAppropriateDiv() {
            if (!isSafari()) {
                document.getElementById('notMobileSafari').classList.remove('hidden');
                document.getElementById('notMobileSafari').classList.add('mainscreen');
                return;
            }
            if(!isiOS()){
              document.getElementById('notMobileSafari').classList.remove('hidden');
              document.getElementById('notMobileSafari').classList.add('mainscreen');
              return;
            } 
            
            if(isInStandaloneMode()) {
                document.getElementById('mainUI').classList.remove('hidden');
                document.getElementById('mainUI').classList.add('mainscreen');
            } else {
                document.getElementById('installPrompt').classList.remove('hidden');
                document.getElementById('installPrompt').classList.add('mainscreen');
            }
        }
       
        function workspaceChosen(){
          let uploader = document.getElementById("workspace-chooser");
          let workspace = uploader.files[0];
          let reader = new FileReader();
          reader.onloadend = launchSystem;
          reader.readAsText(workspace);
        }

        function launchSystem(evt){
          document.open();
          document.write(evt.target.result);
          document.close();
        }

        document.addEventListener('DOMContentLoaded', displayAppropriateDiv);
    </script>
</body>
</html>
